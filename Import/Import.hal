SetLangMode(LangRussian,"RUS",0);globalupdating procedure OdessaIn()BEGIN  record DIVc DIr;  record INVc INr;  val w,vol,coef1,coef2;  Boolean testf,TrHs,testf1;  string 100 code,name,prod,class,group,altc;  integer lenght;  string 20 classfound,brand,type,collection,barcode;  integer coefx;    while (TestEOF()==false) begin    code = ImportField;    name = ImportField;    group = ImportField;    class = ImportField;    prod = ImportField;    altc = ImportField;    coef1 = StringToVal(ImportField,M45Val);    coef2 = StringToVal(ImportField,M45Val);    w = StringToVal(ImportField,M45Val);    vol = StringToVal(ImportField,M45Val);    barcode = ImportField;        INr.Code = code;    if (ReadFirstMain(INr,1,true)) then begin      if (blank(INr.Name)) then begin        INr.Name = name;      end;      coefx = INr.Conversion1;      if(coefx<1)then begin      	coefx = 1;      end;      INr.AlternativeCode = altc;      INr.AddUnittext2 = "Ÿ™ˆŠ";      INr.AddUnitCoef2 = coef1*coefx;      INr.AddUnittext3 = "“";      INr.AddUnitCoef3 = coef2*coefx;      INr.Weight = w/coefx;      INr.Volume = vol/coefx;      INr.BarCode = barcode;      if(nonblank(prod))then begin				DIr.Name = prod;				TrHs = true;				While (loopKey("DIName",DIr,1,TrHs)) begin					testf1 = false;					if (left(DIr.CType,4)=="BRND") then begin testf1 = true; end;					if (DIr.Name!=prod) then begin TrHs = false; testf1 = false; end;					if (testf1) then begin						if (blank(INr.DispGroups)) then begin							INr.DispGroups = DIr.Code;						end else begin							INr.DispGroups = INr.DispGroups & "," & DIr.Code;						end;					end;				end;				resetloop(DIr);			end;			if(nonblank(group))then begin				DIr.Name = group;				TrHs = true;				while (LoopKey("DIName",DIr,1,TrHs)) begin					testf1 = false;					if (left(DIr.CType,4)=="TYPE") then begin testf1 = true; end;					if (DIr.Name!=group) then begin TrHs = false; testf1 = false; end;					if (testf1) then begin						if (blank(INr.DispGroups)) then begin							INr.DispGroups = DIr.Code;						end else begin							INr.DispGroups = INr.DispGroups & "," & DIr.Code;						end;					end;				end;				resetloop(DIr);			end;			if(nonblank(class))then begin				DIr.Name = class;				if (ReadFirstKey("DIName",DIr,1,true)) then begin					if (blank(INr.DispGroups)) then begin						INr.DispGroups = DIr.Code;					end else begin						INr.DispGroups = INr.DispGroups & "," & DIr.Code;					end;				end;			end;			RECORDSTORE(INr,true);    end else begin      INr.Name = code;      if (ReadFirstKey("Name",INr,1,true)) then begin        INr.Name = name;        RECORDSTORE(INr,true);      end else begin      	recordnew(INr);      	INr.Code = code;        if (blank(INr.Name)) then begin          INr.Name = name;        end;        INr.AlternativeCode = altc;        INr.AddUnittext2 = "Ÿ™ˆŠ";        INr.AddUnitCoef2 = coef1;        INr.AddUnittext3 = "“";        INr.AddUnitCoef3 = coef2;        INr.Weight = w;        INr.Volume = vol;        INr.BarCode = barcode;        if(nonblank(prod))then begin					DIr.Name = prod;					TrHs = true;					While (loopKey("DIName",DIr,1,TrHs)) begin						testf1 = false;						if (left(DIr.CType,4)=="BRND") then begin testf1 = true; end;						if (DIr.Name!=prod) then begin TrHs = false; testf1 = false; end;						if (testf1) then begin							if (blank(INr.DispGroups)) then begin								INr.DispGroups = DIr.Code;							end else begin								INr.DispGroups = INr.DispGroups & "," & DIr.Code;							end;						end;					end;					resetloop(DIr);  			end;  			if(nonblank(group))then begin					DIr.Name = group;					TrHs = true;					while (LoopKey("DIName",DIr,1,TrHs)) begin						testf1 = false;						if (left(DIr.CType,4)=="TYPE") then begin testf1 = true; end;						if (DIr.Name!=group) then begin TrHs = false; testf1 = false; end;						if (testf1) then begin							if (blank(INr.DispGroups)) then begin								INr.DispGroups = DIr.Code;							end else begin								INr.DispGroups = INr.DispGroups & "," & DIr.Code;							end;						end;					end;					resetloop(DIr);  			end;  			if(nonblank(class))then begin					DIr.Name = class;					if (ReadFirstKey("DIName",DIr,1,true)) then begin						if (blank(INr.DispGroups)) then begin							INr.DispGroups = DIr.Code;						end else begin							INr.DispGroups = INr.DispGroups & "," & DIr.Code;						end;					end;  			end;  			RECORDSTORE(INr,true);      end;    end;            UserTrace(code,M4Str);      testf = NextImportLine(true);       end;      RETURN;END;global updating procedure ImportVEClassIn()beginstring 100 artcode,ve1,ve2,ve3;record INVc INr;record DIVc DIr;boolean TrHs,testf1;	while (TestEOF()==false) begin		artcode = ImportField;		ve1 = ImportField;		ve2 = ImportField;		ve3 = ImportField;				if(nonblank(artcode))then begin			INr.Code = artcode;			if(readfirstmain(INr,1,true))then begin								if(nonblank(ve1))then begin					DIr.Name = ve1;					TrHs = true;					while (LoopKey("DIName",DIr,1,TrHs)) begin						testf1 = false;						if (DIr.CType=="VENDOR") then begin testf1 = true; end;						if (DIr.Name!=ve1) then begin TrHs = false; testf1 = false; end;						if (testf1) then begin							if (blank(INr.DispGroups)) then begin								INr.DispGroups = DIr.Code;							end else begin								INr.DispGroups = INr.DispGroups & "," & DIr.Code;							end;						end;					end;					resetloop(DIr);  			end;  			if(nonblank(ve2))then begin					DIr.Name = ve2;					TrHs = true;					while (LoopKey("DIName",DIr,1,TrHs)) begin						testf1 = false;						if (DIr.CType=="VENDOR") then begin testf1 = true; end;						if (DIr.Name!=ve2) then begin TrHs = false; testf1 = false; end;						if (testf1) then begin							if (blank(INr.DispGroups)) then begin								INr.DispGroups = DIr.Code;							end else begin								INr.DispGroups = INr.DispGroups & "," & DIr.Code;							end;						end;					end;					resetloop(DIr);  			end;  			if(nonblank(ve3))then begin					DIr.Name = ve3;					TrHs = true;					while (LoopKey("DIName",DIr,1,TrHs)) begin						testf1 = false;						if (DIr.CType=="VENDOR") then begin testf1 = true; end;						if (DIr.Name!=ve3) then begin TrHs = false; testf1 = false; end;						if (testf1) then begin							if (blank(INr.DispGroups)) then begin								INr.DispGroups = DIr.Code;							end else begin								INr.DispGroups = INr.DispGroups & "," & DIr.Code;							end;						end;					end;					resetloop(DIr);  			end;  	  			recordStore(INr,true);					end else begin				INr.Reference = artcode;				if(readfirstkey("Reference",INr,1,true))then begin									if(nonblank(ve1))then begin						DIr.Name = ve1;						TrHs = true;						while (LoopKey("DIName",DIr,1,TrHs)) begin							testf1 = false;							if (DIr.CType=="VENDOR") then begin testf1 = true; end;							if (DIr.Name!=ve1) then begin TrHs = false; testf1 = false; end;							if (testf1) then begin								if (blank(INr.DispGroups)) then begin									INr.DispGroups = DIr.Code;								end else begin									INr.DispGroups = INr.DispGroups & "," & DIr.Code;								end;							end;						end;						resetloop(DIr);					end;					if(nonblank(ve2))then begin						DIr.Name = ve2;						TrHs = true;						while (LoopKey("DIName",DIr,1,TrHs)) begin							testf1 = false;							if (DIr.CType=="VENDOR") then begin testf1 = true; end;							if (DIr.Name!=ve2) then begin TrHs = false; testf1 = false; end;							if (testf1) then begin								if (blank(INr.DispGroups)) then begin									INr.DispGroups = DIr.Code;								end else begin									INr.DispGroups = INr.DispGroups & "," & DIr.Code;								end;							end;						end;						resetloop(DIr);					end;					if(nonblank(ve3))then begin						DIr.Name = ve3;						TrHs = true;						while (LoopKey("DIName",DIr,1,TrHs)) begin							testf1 = false;							if (DIr.CType=="VENDOR") then begin testf1 = true; end;							if (DIr.Name!=ve3) then begin TrHs = false; testf1 = false; end;							if (testf1) then begin								if (blank(INr.DispGroups)) then begin									INr.DispGroups = DIr.Code;								end else begin									INr.DispGroups = INr.DispGroups & "," & DIr.Code;								end;							end;						end;						resetloop(DIr);					end; 					recordStore(INr,true);				end;			end;		end;			NextImportLine(true);       end; 	return;end;global //Edit***************************Sasha2,17:37 15.04.2015 {updating procedure ImportNewItemsWithClassIn()beginstring 100 artcode,class;record INVc INr;boolean TrHs,testf1;	while (TestEOF()==false) begin		artcode = ImportField;		class = ImportField;				if(nonblank(artcode))then begin			INr.Code = artcode;			if(readfirstmain(INr,1,true))then begin				if (NonBlank(INr.DispGroups)) then begin				  INr.DispGroups = INr.DispGroups & "," & class;				end else begin				  INr.DispGroups = class;				end;  			recordStore(INr,true);					end else begin			  RECORDNEW(INr);				INr.Code = artcode;				INr.DispGroups = class;				recordStore(INr,true);			end;		end;			NextImportLine(true);       end; 	return;end; //Edit***************************Sasha2,17:37 15.04.2015 }